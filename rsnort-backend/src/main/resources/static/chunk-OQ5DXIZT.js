import{a as ge}from"./chunk-OB7RAM33.js";import{a as fe}from"./chunk-P3PKAZMN.js";import{f as re,j as N,k as oe}from"./chunk-K3ZDW6YI.js";import{d as se,g as le,k as ce,l as de,m as pe,o as me,u as A}from"./chunk-FANSVRG4.js";import{b as te}from"./chunk-A7VEZ463.js";import{k as ie,l as ne,n as ae}from"./chunk-HVGVPRCV.js";import{a as he,b as ue}from"./chunk-OIW6JI6U.js";import{Aa as s,Ab as H,Db as q,Fb as V,Gb as B,Hb as k,Ic as C,Jc as E,La as U,Ma as S,Qa as m,S as Y,T as x,V as j,X as P,Y as g,Ya as c,Yb as Q,Zb as X,_b as J,a as D,b as T,ba as h,bb as r,bc as Z,c as F,ca as u,cb as a,db as M,eb as O,ec as ee,fb as w,hb as f,jb as _,kb as p,tb as v,ub as o,vb as y,wb as b,xb as L,ya as R,yb as $,zb as G}from"./chunk-GVHJH67V.js";var K=(()=>{class t{static \u0275fac=function(n){return new(n||t)};static \u0275mod=S({type:t});static \u0275inj=x({imports:[ie,C,fe]})}return t})();var _e=new j("mat-select-scroll-strategy",{providedIn:"root",factory:()=>{let t=g(N);return()=>t.scrollStrategies.reposition()}});function ve(t){return()=>t.scrollStrategies.reposition()}var ye={provide:_e,deps:[N],useFactory:ve};var z=(()=>{class t{static \u0275fac=function(n){return new(n||t)};static \u0275mod=S({type:t});static \u0275inj=x({providers:[ye],imports:[oe,K,C,re,A,K,C]})}return t})();var I=class t{constructor(i,e){this.http=i;this.agentSrv=e}get baseUrl(){return`http://${this.agentSrv.current?.ip??"127.0.0.1"}:9000`}getStatus(){return this.http.get(`${this.baseUrl}/status`)}restartSnort(){return this.http.post(`${this.baseUrl}/restart`,{})}listArchivedFiles(){return this.http.get(`${this.baseUrl}/archived-files`)}downloadFile(i){return this.http.get(`${this.baseUrl}/archived-files/${i}`,{responseType:"blob"})}getLastAlert(){return this.http.get(`${this.baseUrl}/alerts/last`)}getAllAgentsStatuses(i){return Promise.all(i.map(e=>this.http.get(`http://${e.ip}:9000/services/status`).toPromise().then(n=>({id:e.id,ip:e.ip,statuses:n})).catch(()=>({id:e.id,ip:e.ip,statuses:null}))))}getLastAlertFrom(i){return this.http.get(`http://${i}:9000/alerts/last`)}restartService(i,e){return this.http.post(`http://${i}:9000/services/${e}/restart`,{})}static \u0275fac=function(e){return new(e||t)(P(ee),P(E))};static \u0275prov=Y({token:t,factory:t.\u0275fac,providedIn:"root"})};var xe=()=>["snort","ingest","metrics"];function Se(t,i){if(t&1&&(r(0,"p")(1,"strong"),o(2,"\xDAltima alerta:"),a(),r(3,"code",16),o(4),a()()),t&2){let e=p(2);s(4),L("",e.lastAlert.msg," \u2014 ",e.lastAlert.timestamp,"")}}function Me(t,i){if(t&1&&(O(0),r(1,"p")(2,"strong"),o(3,"Agente:"),a(),r(4,"code",16),o(5),a()(),r(6,"p")(7,"strong"),o(8,"Estado:"),a(),r(9,"code",17),o(10),a()(),m(11,Se,5,2,"p",18),w()),t&2){let e=p();s(5),y(e.status.agent_id),s(4),c("ngClass",e.status.snort_running?"api-up":"api-down"),s(),b(" ",e.status.snort_running?"Activo":"Inactivo"," "),s(),c("ngIf",e.lastAlert)}}function Oe(t,i){t&1&&(r(0,"p"),o(1,"No se ha podido obtener el estado del agente."),a())}function we(t,i){if(t&1&&(r(0,"option",25),o(1),a()),t&2){let e=i.$implicit;c("value",e),s(),y(e)}}function ke(t,i){if(t&1){let e=f();O(0),r(1,"div",19)(2,"label",20),o(3,"Selecciona archivo"),a(),r(4,"select",21),H("ngModelChange",function(l){h(e);let d=p();return G(d.selectedFile,l)||(d.selectedFile=l),u(l)}),r(5,"option",22),o(6,"-- elige un archivo --"),a(),m(7,we,2,2,"option",23),a(),r(8,"button",24),_("click",function(){h(e);let l=p();return u(l.download(l.selectedFile))}),o(9," Descargar "),a()(),w()}if(t&2){let e=p();s(4),$("ngModel",e.selectedFile),s(3),c("ngForOf",e.archived),s(),c("disabled",!e.selectedFile)}}function Ee(t,i){t&1&&(r(0,"p"),o(1,"No hay archivos disponibles."),a())}function Ae(t,i){if(t&1){let e=f();r(0,"div",27)(1,"strong"),o(2),a(),r(3,"code",17),o(4),a(),r(5,"button",28),_("click",function(){let l=h(e).$implicit,d=p(2).$implicit,Ce=p();return u(Ce.restartAgentService(d.id,d.ip,l))}),o(6," \u{1F501} Reiniciar "),a()()}if(t&2){let e=i.$implicit,n=p(2).$implicit,l=p();s(2),b("",e,":"),s(),c("ngClass",n.statuses[e]==="active"?"api-up":"api-down"),s(),b(" ",n.statuses[e]||"desconocido"," "),s(),c("disabled",l.loadingServices[n.id][e])}}function Ie(t,i){if(t&1&&(r(0,"p")(1,"strong"),o(2,"\xDAltima alerta:"),a(),r(3,"code",16),o(4),a()()),t&2){let e=p(2).$implicit;s(4),L(" ",e.lastAlert.msg," \u2014 ",e.lastAlert.timestamp," ")}}function De(t,i){if(t&1&&(O(0),r(1,"p")(2,"strong"),o(3,"IP:"),a(),r(4,"code",16),o(5),a()(),m(6,Ae,7,4,"div",26)(7,Ie,5,2,"p",18),w()),t&2){let e=p().$implicit;s(5),y(e.ip),s(),c("ngForOf",q(3,xe)),s(),c("ngIf",e.lastAlert)}}function Te(t,i){t&1&&(r(0,"p")(1,"strong"),o(2,"Estado:"),a(),r(3,"code",29),o(4,"No accesible"),a()())}function Fe(t,i){if(t&1&&(r(0,"mat-card",8)(1,"h2"),o(2),a(),m(3,De,8,4,"ng-container",9)(4,Te,5,0,"ng-template",null,2,k),a()),t&2){let e=i.$implicit,n=v(5);s(2),b("\u{1F310} Estado del agente ",e.id,""),s(),c("ngIf",e.statuses)("ngIfElse",n)}}var be=class t{agentSrv=g(E);api=g(I);status;lastAlert;archived=[];selectedFile="";loading=!1;sub;intervalId;allAgentsInterval;agentStates=[];loadingServices={};ngOnInit(){this.sub=this.agentSrv.current$.subscribe(i=>{i&&(this.refreshStatus(),this.loadArchived(),this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval(()=>this.refreshStatus(),5e3))}),this.refreshAllAgentsStates(),this.allAgentsInterval=setInterval(()=>{this.refreshAllAgentsStates()},5e3)}ngOnDestroy(){this.sub?.unsubscribe(),this.intervalId&&clearInterval(this.intervalId),this.allAgentsInterval&&clearInterval(this.allAgentsInterval)}refreshStatus(){this.api.getStatus().subscribe({next:i=>this.status=i,error:()=>this.status=void 0}),this.api.getLastAlert().subscribe({next:i=>this.lastAlert=i,error:()=>this.lastAlert=void 0})}loadArchived(){this.api.listArchivedFiles().subscribe(i=>{this.archived=i})}restartSnort(){this.loading=!0,this.api.restartSnort().subscribe({next:()=>{this.refreshStatus(),this.loading=!1},error:()=>this.loading=!1})}download(i){this.api.downloadFile(i).subscribe(e=>{let n=URL.createObjectURL(e),l=document.createElement("a");l.href=n,l.download=i,l.click(),URL.revokeObjectURL(n)})}get ip(){return this.agentSrv.current?.ip??"127.0.0.1"}get tempPanelUrl(){return`http://${this.ip}:3000/d-solo/ALgSiPiWk/snort-ids-ips-dashboard?orgId=1&panelId=29&refresh=1m`}get sysPanelUrl(){return`http://${this.ip}:3000/d-solo/ALgSiPiWk/snort-ids-ips-dashboard?orgId=1&panelId=28&refresh=1m`}refreshAllAgentsStates(){return F(this,null,function*(){let i=this.agentSrv.getAll(),e=yield this.api.getAllAgentsStatuses(i),n=yield Promise.all(e.map(l=>F(this,null,function*(){try{let d=yield this.api.getLastAlertFrom(l.ip).toPromise();return T(D({},l),{lastAlert:d})}catch{return T(D({},l),{lastAlert:void 0})}})));this.agentStates=n,n.forEach(l=>{this.loadingServices[l.id]||(this.loadingServices[l.id]={snort:!1,ingest:!1,metrics:!1})})})}restartAgentService(i,e,n){this.loadingServices[i][n]=!0,this.api.restartService(e,n).subscribe({next:()=>{this.refreshAllAgentsStates(),this.loadingServices[i][n]=!1},error:()=>{this.loadingServices[i][n]=!1}})}confirmDelete(i){let e=i;!confirm(`\u{1F5D1} \xBFEliminar el agente "${e}"?

Esta acci\xF3n eliminar\xE1 su entrada del sistema.`)||!confirm(`\u26A0\uFE0F Confirmaci\xF3n final:

\xBFEst\xE1s COMPLETAMENTE seguro de que deseas eliminar "${e}"?`)||this.agentSrv.remove(i).then(()=>{alert(`\u2705 Agente "${e}" eliminado correctamente.`),this.refreshAllAgentsStates()}).catch(d=>{alert(`\u274C Error al eliminar el agente "${e}": ${d?.error||d}`)})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=U({type:t,selectors:[["app-status"]],decls:28,vars:12,consts:[["noStatus",""],["noFiles",""],["unreachable",""],[1,"dashboard"],[1,"graphs-column"],[1,"grafana-card"],["width","100%","height","300","frameborder","0",3,"src"],[1,"status-column"],[1,"status-card"],[4,"ngIf","ngIfElse"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"status-card","archived-panel"],[1,"agents"],[1,"agent-section-title"],[1,"agents-grid"],["class","status-card",4,"ngFor","ngForOf"],[1,"api-value"],[1,"api-value",3,"ngClass"],[4,"ngIf"],[1,"archived-select-container"],["for","archivedSelect",1,"archived-label"],["id","archivedSelect",1,"archived-native-select",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],["mat-stroked-button","","color","accent",3,"click","disabled"],[3,"value"],["class","agent-service",4,"ngFor","ngForOf"],[1,"agent-service"],["mat-mini-button","","color","accent",3,"click","disabled"],[1,"api-down"]],template:function(e,n){if(e&1){let l=f();r(0,"div",3)(1,"div",4)(2,"mat-card",5),M(3,"iframe",6),V(4,"safeUrl"),a(),r(5,"mat-card",5),M(6,"iframe",6),V(7,"safeUrl"),a()(),r(8,"div",7)(9,"mat-card",8)(10,"h2"),o(11,"\u{1F6E1} Estado de Snort"),a(),m(12,Me,12,4,"ng-container",9)(13,Oe,2,0,"ng-template",null,0,k),r(15,"button",10),_("click",function(){return h(l),u(n.restartSnort())}),o(16," \u{1F501} Reiniciar Snort "),a()(),r(17,"mat-card",11)(18,"h2"),o(19,"Logs archivados"),a(),m(20,ke,10,3,"ng-container",9)(21,Ee,2,0,"ng-template",null,1,k),a()(),r(23,"div",12)(24,"h2",13),o(25,"\u{1F4E1} Estado general de los agentes"),a(),r(26,"div",14),m(27,Fe,6,3,"mat-card",15),a()()()}if(e&2){let l=v(14),d=v(22);s(3),c("src",B(4,8,n.tempPanelUrl),R),s(3),c("src",B(7,10,n.sysPanelUrl),R),s(6),c("ngIf",n.status)("ngIfElse",l),s(3),c("disabled",n.loading),s(5),c("ngIf",n.archived.length)("ngIfElse",d),s(7),c("ngForOf",n.agentStates)}},dependencies:[Z,Q,X,J,ue,he,ae,ne,ge,A,z,me,de,pe,ce,se,le,te],styles:[`@font-face{font-family:JetBrains Mono;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v20/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTN1OVgaY.woff2) format("woff2");unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:JetBrains Mono;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v20/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTPlOVgaY.woff2) format("woff2");unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:JetBrains Mono;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v20/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTOVOVgaY.woff2) format("woff2");unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:JetBrains Mono;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v20/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTNVOVgaY.woff2) format("woff2");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:JetBrains Mono;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v20/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTNFOVgaY.woff2) format("woff2");unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:JetBrains Mono;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v20/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTOlOV.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}[_ngcontent-%COMP%]:root{--primary-neon: #00e1ff;--dark-surface: #1a1a1a;--dark-elevated: #242424;--text-primary: #ffffff}.dashboard[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr;grid-template-rows:auto 1fr;grid-template-areas:"graphs status" "agents agents";gap:2rem;padding:2rem;box-sizing:border-box;min-height:calc(100vh - 64px)}.graphs-column[_ngcontent-%COMP%]{grid-area:graphs;display:flex;flex-direction:column;gap:2rem}.status-column[_ngcontent-%COMP%]{grid-area:status;display:flex;flex-direction:column;gap:2rem}.agents[_ngcontent-%COMP%]{grid-area:agents}.agents-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:2rem}.grafana-card[_ngcontent-%COMP%]{background:#111;color:#fff;padding:.5rem;border-radius:12px;box-shadow:0 0 20px #03dac64d}.status-card[_ngcontent-%COMP%]{background:var(--dark-surface);color:var(--text-primary);padding:1.2rem;border-radius:12px;box-shadow:0 0 12px #64ffda26;font-family:Inter,sans-serif}.status-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1rem;color:#03dac6;font-weight:600}.api-value[_ngcontent-%COMP%]{font-family:JetBrains Mono,monospace;background:var(--dark-elevated);border-radius:6px;padding:4px 8px}.api-up[_ngcontent-%COMP%]{color:#00e676!important;font-weight:700}.api-down[_ngcontent-%COMP%]{color:#ff5252!important;font-weight:700}.archived-panel[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:space-between}.archived-panel[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:1rem;padding-left:1.5em;position:relative}.archived-panel[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]:before{content:"\\1f4c2";position:absolute;left:0;color:var(--primary-neon)}.archived-select-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;align-items:center;justify-content:center;text-align:center}.archived-label[_ngcontent-%COMP%]{color:var(--text-primary);font-weight:500}.archived-native-select[_ngcontent-%COMP%]{width:100%;min-width:200px;height:42px;color:var(--text-primary);background:var(--dark-elevated);border:1px solid var(--primary-neon);border-radius:6px;padding:0 12px;font-weight:500;font-size:14px;appearance:none;background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2300e1ff'><path d='M7 10l5 5 5-5z'/></svg>");background-repeat:no-repeat;background-position:right 10px center;cursor:pointer;transition:border .3s,box-shadow .3s,background .3s}.archived-native-select[_ngcontent-%COMP%]:hover{box-shadow:0 0 8px #00e1ff66}.archived-native-select[_ngcontent-%COMP%]:focus{outline:none;border-color:#03dac6;box-shadow:0 0 6px #03dac699}.archived-native-select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{background:var(--dark-surface);color:var(--text-primary)}.archived-panel[_ngcontent-%COMP%]   button.mat-stroked-button[_ngcontent-%COMP%]{align-self:flex-start;height:40px;padding:0 16px;border-radius:6px;background:var(--dark-surface)!important;border:1px solid var(--primary-neon)!important;color:var(--primary-neon)!important;box-shadow:4px 4px 8px #000c,-4px -4px 8px #ffffff0d!important;transition:background .3s,box-shadow .3s,color .3s}.archived-panel[_ngcontent-%COMP%]   button.mat-stroked-button[_ngcontent-%COMP%]:hover:not(.mat-button-disabled){background:var(--primary-neon)!important;color:var(--dark-surface)!important;box-shadow:inset 4px 4px 8px #000c,inset -4px -4px 8px #ffffff0d!important}.archived-panel[_ngcontent-%COMP%]   button.mat-stroked-button[_ngcontent-%COMP%]:before{content:"\\1f4e5";margin-right:6px}.archived-panel[_ngcontent-%COMP%]   button.mat-stroked-button.mat-button-disabled[_ngcontent-%COMP%]{opacity:.6;border-color:#e0e0e04d!important;color:#e0e0e04d!important}.agent-section-title[_ngcontent-%COMP%]{display:none}@media (max-width: 768px){.dashboard[_ngcontent-%COMP%]{grid-template-columns:1fr;grid-template-areas:"graphs" "status" "agents"}}.agent-service[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:.5rem;flex-wrap:wrap}.agent-service[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{min-width:70px}.agent-service[_ngcontent-%COMP%]   .api-value[_ngcontent-%COMP%]{min-width:90px;text-align:center}.archived-panel[_ngcontent-%COMP%]   button.mat-stroked-button[_ngcontent-%COMP%]{align-self:center}.archived-native-select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{background-color:var(--dark-elevated);color:var(--text-primary)}.archived-native-select[_ngcontent-%COMP%]:focus   option[_ngcontent-%COMP%]{background-color:var(--dark-elevated);color:var(--text-primary)}.archived-native-select[_ngcontent-%COMP%]{background-color:var(--dark-elevated);color:var(--text-primary);border:1px solid var(--primary-neon);border-radius:6px;padding:0 12px;font-weight:500;font-size:14px;appearance:none;background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2300e1ff'><path d='M7 10l5 5 5-5z'/></svg>");background-repeat:no-repeat;background-position:right 10px center;transition:background .3s,box-shadow .3s}.delete-agent-wrapper[_ngcontent-%COMP%]{margin-top:1rem;display:flex;align-items:center;gap:.5rem;justify-content:flex-end}.delete-label[_ngcontent-%COMP%]{color:#f66;font-weight:600;font-size:.9rem}`]})};export{be as StatusComponent};
