import{a as de}from"./chunk-YAAELXRA.js";import{a as pe}from"./chunk-OB7RAM33.js";import{a as me}from"./chunk-P3PKAZMN.js";import{f as Z,j as V,k as ee}from"./chunk-K3ZDW6YI.js";import{d as ie,g as ne,k as ae,l as re,m as oe,o as se,u as A}from"./chunk-FANSVRG4.js";import{b as H}from"./chunk-A7VEZ463.js";import{k as Q,l as X,n as J}from"./chunk-HVGVPRCV.js";import{a as le,b as ce}from"./chunk-OIW6JI6U.js";import{Aa as s,Ab as z,Db as Y,Fb as R,Gb as U,Hb as k,Ic as C,Jc as te,La as F,Ma as M,Qa as m,T as S,V as N,Y as g,Ya as c,Yb as G,Zb as j,_b as q,a as D,b as I,ba as h,bb as r,bc as $,c as x,ca as u,cb as n,db as O,eb as w,fb as E,hb as f,jb as _,kb as p,tb as v,ub as o,vb as y,wb as b,xb as P,ya as T,yb as W,zb as K}from"./chunk-GVHJH67V.js";var L=(()=>{class t{static \u0275fac=function(a){return new(a||t)};static \u0275mod=M({type:t});static \u0275inj=S({imports:[Q,C,me]})}return t})();var ue=new N("mat-select-scroll-strategy",{providedIn:"root",factory:()=>{let t=g(V);return()=>t.scrollStrategies.reposition()}});function ge(t){return()=>t.scrollStrategies.reposition()}var fe={provide:ue,deps:[V],useFactory:ge};var B=(()=>{class t{static \u0275fac=function(a){return new(a||t)};static \u0275mod=M({type:t});static \u0275inj=S({providers:[fe],imports:[ee,L,C,Z,A,L,C]})}return t})();var ye=()=>["snort","ingest","metrics"];function be(t,i){if(t&1&&(r(0,"p")(1,"strong"),o(2,"\xDAltima alerta:"),n(),r(3,"code",16),o(4),n()()),t&2){let e=p(2);s(4),P("",e.lastAlert.msg," \u2014 ",e.lastAlert.timestamp,"")}}function Ce(t,i){if(t&1&&(w(0),r(1,"p")(2,"strong"),o(3,"Agente:"),n(),r(4,"code",16),o(5),n()(),r(6,"p")(7,"strong"),o(8,"Estado:"),n(),r(9,"code",17),o(10),n()(),m(11,be,5,2,"p",18),E()),t&2){let e=p();s(5),y(e.status.agent_id),s(4),c("ngClass",e.status.snort_running?"api-up":"api-down"),s(),b(" ",e.status.snort_running?"Activo":"Inactivo"," "),s(),c("ngIf",e.lastAlert)}}function xe(t,i){t&1&&(r(0,"p"),o(1,"No se ha podido obtener el estado del agente."),n())}function Se(t,i){if(t&1&&(r(0,"option",25),o(1),n()),t&2){let e=i.$implicit;c("value",e),s(),y(e)}}function Me(t,i){if(t&1){let e=f();w(0),r(1,"div",19)(2,"label",20),o(3,"Selecciona archivo"),n(),r(4,"select",21),z("ngModelChange",function(l){h(e);let d=p();return K(d.selectedFile,l)||(d.selectedFile=l),u(l)}),r(5,"option",22),o(6,"-- elige un archivo --"),n(),m(7,Se,2,2,"option",23),n(),r(8,"button",24),_("click",function(){h(e);let l=p();return u(l.download(l.selectedFile))}),o(9," Descargar "),n()(),E()}if(t&2){let e=p();s(4),W("ngModel",e.selectedFile),s(3),c("ngForOf",e.archived),s(),c("disabled",!e.selectedFile)}}function Oe(t,i){t&1&&(r(0,"p"),o(1,"No hay archivos disponibles."),n())}function we(t,i){if(t&1){let e=f();r(0,"div",27)(1,"strong"),o(2),n(),r(3,"code",17),o(4),n(),r(5,"button",28),_("click",function(){let l=h(e).$implicit,d=p(2).$implicit,ve=p();return u(ve.restartAgentService(d.id,d.ip,l))}),o(6," \u{1F501} Reiniciar "),n()()}if(t&2){let e=i.$implicit,a=p(2).$implicit,l=p();s(2),b("",e,":"),s(),c("ngClass",a.statuses[e]==="active"?"api-up":"api-down"),s(),b(" ",a.statuses[e]||"desconocido"," "),s(),c("disabled",l.loadingServices[a.id][e])}}function Ee(t,i){if(t&1&&(r(0,"p")(1,"strong"),o(2,"\xDAltima alerta:"),n(),r(3,"code",16),o(4),n()()),t&2){let e=p(2).$implicit;s(4),P(" ",e.lastAlert.msg," \u2014 ",e.lastAlert.timestamp," ")}}function ke(t,i){if(t&1&&(w(0),r(1,"p")(2,"strong"),o(3,"IP:"),n(),r(4,"code",16),o(5),n()(),m(6,we,7,4,"div",26)(7,Ee,5,2,"p",18),E()),t&2){let e=p().$implicit;s(5),y(e.ip),s(),c("ngForOf",Y(3,ye)),s(),c("ngIf",e.lastAlert)}}function Ae(t,i){t&1&&(r(0,"p")(1,"strong"),o(2,"Estado:"),n(),r(3,"code",29),o(4,"No accesible"),n()())}function De(t,i){if(t&1&&(r(0,"mat-card",8)(1,"h2"),o(2),n(),m(3,ke,8,4,"ng-container",9)(4,Ae,5,0,"ng-template",null,2,k),n()),t&2){let e=i.$implicit,a=v(5);s(2),b("\u{1F310} Estado del agente ",e.id,""),s(),c("ngIf",e.statuses)("ngIfElse",a)}}var _e=class t{agentSrv=g(te);api=g(de);uid="";status;lastAlert;archived=[];selectedFile="";loading=!1;sub;intervalId;allAgentsInterval;agentStates=[];loadingServices={};ngOnInit(){return x(this,null,function*(){try{this.uid=yield this.api.getGrafanaDashboardUid()}catch(i){console.error("Error al obtener el UID del dashboard:",i)}this.sub=this.agentSrv.current$.subscribe(i=>{i&&(this.refreshStatus(),this.loadArchived(),this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval(()=>this.refreshStatus(),5e3))}),this.refreshAllAgentsStates(),this.allAgentsInterval=setInterval(()=>{this.refreshAllAgentsStates()},5e3)})}ngOnDestroy(){this.sub?.unsubscribe(),this.intervalId&&clearInterval(this.intervalId),this.allAgentsInterval&&clearInterval(this.allAgentsInterval)}refreshStatus(){this.api.getStatus().subscribe({next:i=>this.status=i,error:()=>this.status=void 0}),this.api.getLastAlert().subscribe({next:i=>this.lastAlert=i,error:()=>this.lastAlert=void 0})}loadArchived(){this.api.listArchivedFiles().subscribe(i=>{this.archived=i})}restartSnort(){this.loading=!0,this.api.restartSnort().subscribe({next:()=>{this.refreshStatus(),this.loading=!1},error:()=>this.loading=!1})}download(i){this.api.downloadFile(i).subscribe(e=>{let a=URL.createObjectURL(e),l=document.createElement("a");l.href=a,l.download=i,l.click(),URL.revokeObjectURL(a)})}get ip(){return this.agentSrv.current?.ip??"127.0.0.1"}get tempPanelUrl(){return`http://${this.ip}:3000/d-solo/${this.uid}/snort-ids-ips-dashboard?orgId=1&panelId=29&refresh=1m`}get sysPanelUrl(){return`http://${this.ip}:3000/d-solo/${this.uid}/snort-ids-ips-dashboard?orgId=1&panelId=28&refresh=1m`}refreshAllAgentsStates(){return x(this,null,function*(){let i=this.agentSrv.getAll(),e=yield this.api.getAllAgentsStatuses(i),a=yield Promise.all(e.map(l=>x(this,null,function*(){try{let d=yield this.api.getLastAlertFrom(l.ip).toPromise();return I(D({},l),{lastAlert:d})}catch{return I(D({},l),{lastAlert:void 0})}})));this.agentStates=a,a.forEach(l=>{this.loadingServices[l.id]||(this.loadingServices[l.id]={snort:!1,ingest:!1,metrics:!1})})})}restartAgentService(i,e,a){this.loadingServices[i][a]=!0,this.api.restartService(e,a).subscribe({next:()=>{this.refreshAllAgentsStates(),this.loadingServices[i][a]=!1},error:()=>{this.loadingServices[i][a]=!1}})}confirmDelete(i){let e=i;!confirm(`\u{1F5D1} \xBFEliminar el agente "${e}"?

Esta acci\xF3n eliminar\xE1 su entrada del sistema.`)||!confirm(`\u26A0\uFE0F Confirmaci\xF3n final:

\xBFEst\xE1s COMPLETAMENTE seguro de que deseas eliminar "${e}"?`)||this.agentSrv.remove(i).then(()=>{alert(`\u2705 Agente "${e}" eliminado correctamente.`),this.refreshAllAgentsStates()}).catch(d=>{alert(`\u274C Error al eliminar el agente "${e}": ${d?.error||d}`)})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=F({type:t,selectors:[["app-status"]],decls:28,vars:12,consts:[["noStatus",""],["noFiles",""],["unreachable",""],[1,"dashboard"],[1,"graphs-column"],[1,"grafana-card"],["width","100%","height","300","frameborder","0",3,"src"],[1,"status-column"],[1,"status-card"],[4,"ngIf","ngIfElse"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"status-card","archived-panel"],[1,"agents"],[1,"agent-section-title"],[1,"agents-grid"],["class","status-card",4,"ngFor","ngForOf"],[1,"api-value"],[1,"api-value",3,"ngClass"],[4,"ngIf"],[1,"archived-select-container"],["for","archivedSelect",1,"archived-label"],["id","archivedSelect",1,"archived-native-select",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],["mat-stroked-button","","color","accent",3,"click","disabled"],[3,"value"],["class","agent-service",4,"ngFor","ngForOf"],[1,"agent-service"],["mat-mini-button","","color","accent",3,"click","disabled"],[1,"api-down"]],template:function(e,a){if(e&1){let l=f();r(0,"div",3)(1,"div",4)(2,"mat-card",5),O(3,"iframe",6),R(4,"safeUrl"),n(),r(5,"mat-card",5),O(6,"iframe",6),R(7,"safeUrl"),n()(),r(8,"div",7)(9,"mat-card",8)(10,"h2"),o(11,"\u{1F6E1} Estado de Snort"),n(),m(12,Ce,12,4,"ng-container",9)(13,xe,2,0,"ng-template",null,0,k),r(15,"button",10),_("click",function(){return h(l),u(a.restartSnort())}),o(16," \u{1F501} Reiniciar Snort "),n()(),r(17,"mat-card",11)(18,"h2"),o(19,"Logs archivados"),n(),m(20,Me,10,3,"ng-container",9)(21,Oe,2,0,"ng-template",null,1,k),n()(),r(23,"div",12)(24,"h2",13),o(25,"\u{1F4E1} Estado general de los agentes"),n(),r(26,"div",14),m(27,De,6,3,"mat-card",15),n()()()}if(e&2){let l=v(14),d=v(22);s(3),c("src",U(4,8,a.tempPanelUrl),T),s(3),c("src",U(7,10,a.sysPanelUrl),T),s(6),c("ngIf",a.status)("ngIfElse",l),s(3),c("disabled",a.loading),s(5),c("ngIf",a.archived.length)("ngIfElse",d),s(7),c("ngForOf",a.agentStates)}},dependencies:[$,G,j,q,ce,le,J,X,pe,A,B,se,re,oe,ae,ie,ne,H],styles:[`@font-face{font-family:JetBrains Mono;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v20/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTN1OVgaY.woff2) format("woff2");unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:JetBrains Mono;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v20/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTPlOVgaY.woff2) format("woff2");unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:JetBrains Mono;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v20/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTOVOVgaY.woff2) format("woff2");unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:JetBrains Mono;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v20/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTNVOVgaY.woff2) format("woff2");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:JetBrains Mono;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v20/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTNFOVgaY.woff2) format("woff2");unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:JetBrains Mono;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v20/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTOlOV.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}[_ngcontent-%COMP%]:root{--primary-neon: #00e1ff;--dark-surface: #1a1a1a;--dark-elevated: #242424;--text-primary: #ffffff}.dashboard[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr;grid-template-rows:auto 1fr;grid-template-areas:"graphs status" "agents agents";gap:2rem;padding:2rem;box-sizing:border-box;min-height:calc(100vh - 64px)}.graphs-column[_ngcontent-%COMP%]{grid-area:graphs;display:flex;flex-direction:column;gap:2rem}.status-column[_ngcontent-%COMP%]{grid-area:status;display:flex;flex-direction:column;gap:2rem}.agents[_ngcontent-%COMP%]{grid-area:agents}.agents-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:2rem}.grafana-card[_ngcontent-%COMP%]{background:#111;color:#fff;padding:.5rem;border-radius:12px;box-shadow:0 0 20px #03dac64d}.status-card[_ngcontent-%COMP%]{background:var(--dark-surface);color:var(--text-primary);padding:1.2rem;border-radius:12px;box-shadow:0 0 12px #64ffda26;font-family:Inter,sans-serif}.status-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1rem;color:#03dac6;font-weight:600}.api-value[_ngcontent-%COMP%]{font-family:JetBrains Mono,monospace;background:var(--dark-elevated);border-radius:6px;padding:4px 8px}.api-up[_ngcontent-%COMP%]{color:#00e676!important;font-weight:700}.api-down[_ngcontent-%COMP%]{color:#ff5252!important;font-weight:700}.archived-panel[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:space-between}.archived-panel[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:1rem;padding-left:1.5em;position:relative}.archived-panel[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]:before{content:"\\1f4c2";position:absolute;left:0;color:var(--primary-neon)}.archived-select-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;align-items:center;justify-content:center;text-align:center}.archived-label[_ngcontent-%COMP%]{color:var(--text-primary);font-weight:500}.archived-native-select[_ngcontent-%COMP%]{width:100%;min-width:200px;height:42px;color:var(--text-primary);background:var(--dark-elevated);border:1px solid var(--primary-neon);border-radius:6px;padding:0 12px;font-weight:500;font-size:14px;appearance:none;background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2300e1ff'><path d='M7 10l5 5 5-5z'/></svg>");background-repeat:no-repeat;background-position:right 10px center;cursor:pointer;transition:border .3s,box-shadow .3s,background .3s}.archived-native-select[_ngcontent-%COMP%]:hover{box-shadow:0 0 8px #00e1ff66}.archived-native-select[_ngcontent-%COMP%]:focus{outline:none;border-color:#03dac6;box-shadow:0 0 6px #03dac699}.archived-native-select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{background:var(--dark-surface);color:var(--text-primary)}.archived-panel[_ngcontent-%COMP%]   button.mat-stroked-button[_ngcontent-%COMP%]{align-self:flex-start;height:40px;padding:0 16px;border-radius:6px;background:var(--dark-surface)!important;border:1px solid var(--primary-neon)!important;color:var(--primary-neon)!important;box-shadow:4px 4px 8px #000c,-4px -4px 8px #ffffff0d!important;transition:background .3s,box-shadow .3s,color .3s}.archived-panel[_ngcontent-%COMP%]   button.mat-stroked-button[_ngcontent-%COMP%]:hover:not(.mat-button-disabled){background:var(--primary-neon)!important;color:var(--dark-surface)!important;box-shadow:inset 4px 4px 8px #000c,inset -4px -4px 8px #ffffff0d!important}.archived-panel[_ngcontent-%COMP%]   button.mat-stroked-button[_ngcontent-%COMP%]:before{content:"\\1f4e5";margin-right:6px}.archived-panel[_ngcontent-%COMP%]   button.mat-stroked-button.mat-button-disabled[_ngcontent-%COMP%]{opacity:.6;border-color:#e0e0e04d!important;color:#e0e0e04d!important}.agent-section-title[_ngcontent-%COMP%]{display:none}@media (max-width: 768px){.dashboard[_ngcontent-%COMP%]{grid-template-columns:1fr;grid-template-areas:"graphs" "status" "agents"}}.agent-service[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:.5rem;flex-wrap:wrap}.agent-service[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{min-width:70px}.agent-service[_ngcontent-%COMP%]   .api-value[_ngcontent-%COMP%]{min-width:90px;text-align:center}.archived-panel[_ngcontent-%COMP%]   button.mat-stroked-button[_ngcontent-%COMP%]{align-self:center}.archived-native-select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{background-color:var(--dark-elevated);color:var(--text-primary)}.archived-native-select[_ngcontent-%COMP%]:focus   option[_ngcontent-%COMP%]{background-color:var(--dark-elevated);color:var(--text-primary)}.archived-native-select[_ngcontent-%COMP%]{background-color:var(--dark-elevated);color:var(--text-primary);border:1px solid var(--primary-neon);border-radius:6px;padding:0 12px;font-weight:500;font-size:14px;appearance:none;background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2300e1ff'><path d='M7 10l5 5 5-5z'/></svg>");background-repeat:no-repeat;background-position:right 10px center;transition:background .3s,box-shadow .3s}.delete-agent-wrapper[_ngcontent-%COMP%]{margin-top:1rem;display:flex;align-items:center;gap:.5rem;justify-content:flex-end}.delete-label[_ngcontent-%COMP%]{color:#f66;font-weight:600;font-size:.9rem}`]})};export{_e as StatusComponent};
